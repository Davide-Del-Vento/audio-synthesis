<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Synthesis</title>
</head>
<body>
    <h1>Audio Synthesis with Web Audio API</h1>
    
    <script>
        let audioCtx;
        let osc1, osc2, noise, noiseGain;

        function startAudio(freq1, amp1, freq2, amp2, noiseAmp) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            // Create oscillators
            osc1 = audioCtx.createOscillator();
            const gain1 = audioCtx.createGain();
            osc1.type = 'sine';
            osc1.frequency.value = freq1;
            gain1.gain.value = amp1;

            osc1.connect(gain1);
            gain1.connect(audioCtx.destination);
            osc1.start();

            osc2 = audioCtx.createOscillator();
            const gain2 = audioCtx.createGain();
            osc2.type = 'sine';
            osc2.frequency.value = freq2;
            gain2.gain.value = amp2;

            osc2.connect(gain2);
            gain2.connect(audioCtx.destination);
            osc2.start();

            // Create pink noise
            const bufferSize = 4096;
            noise = audioCtx.createScriptProcessor(bufferSize, 1, 1);
            noiseGain = audioCtx.createGain();
            noiseGain.gain.value = noiseAmp;

            noise.onaudioprocess = function(e) {
                const output = e.outputBuffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) {
                    output[i] = (Math.random() * 2 - 1) * noiseAmp;
                }
            };

            noise.connect(noiseGain);
            noiseGain.connect(audioCtx.destination);

            // Start the noise
            noise.connect(audioCtx.destination);
        }

        function stopAudio() {
            if (osc1) osc1.stop();
            if (osc2) osc2.stop();
            if (noise) noise.disconnect();
            if (audioCtx) audioCtx.close();
        }

        // Check URL params on page load
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const freq1 = parseFloat(urlParams.get('freq1')) || 440;
            const amp1 = parseFloat(urlParams.get('amp1')) || 0.5;
            const freq2 = parseFloat(urlParams.get('freq2')) || 660;
            const amp2 = parseFloat(urlParams.get('amp2')) || 0.5;
            const noiseAmp = parseFloat(urlParams.get('noiseAmp')) || 0.2;
            const action = urlParams.get('action');

            if (action === 'play') {
                startAudio(freq1, amp1, freq2, amp2, noiseAmp);
            } else if (action === 'stop') {
                stopAudio();
            }
        };
    </script>
</body>
</html>
